<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz - Transcri√ß√£o do DNA</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(to right, #0f172a, #1e293b);
    color: #f8fafc;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }

  .container {
    background: #1e293b;
    border-radius: 15px;
    padding: 25px;
    width: 95%;
    max-width: 700px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.4);
    text-align: center;
  }

  h1 { margin-bottom: 20px; color: #38bdf8; }
  h2,h3 { color: #38bdf8; margin-bottom: 10px; }

  input[type="text"] {
    width: 80%;
    padding: 10px;
    border-radius: 8px;
    border: 2px solid #38bdf8;
    font-size: 16px;
    text-align: center;
    margin-bottom: 15px;
    outline: none;
    transition: 0.3s;
  }
  input[type="text"]:focus { border-color: #0ea5e9; }

  button {
    padding: 10px 20px;
    margin: 8px;
    border: none;
    border-radius: 8px;
    background: #38bdf8;
    color: #0f172a;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
  }
  button:hover { background: #0ea5e9; }

  .hidden { display: none; }

  .scoreboard {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    margin-bottom: 10px;
    gap: 10px;
    font-size: 14px;
  }
  .scoreboard img {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    border: 2px solid #38bdf8;
    object-fit: cover;
  }

  .question { font-size: 18px; margin-bottom: 15px; }
  .options { display: flex; flex-direction: column; gap: 10px; }

  .timer { font-size: 16px; margin-top: 10px; color: #facc15; font-weight: bold; }

  .rank-list, .about-text {
    text-align: left;
    margin: 10px 0;
    background: #0f172a;
    border-radius: 10px;
    padding: 10px;
    max-height: 250px;
    overflow-y: auto;
  }

  .file-input { margin: 15px 0; text-align: center; }
  .avatar-label {
    display: inline-block;
    padding: 8px 15px;
    border-radius: 8px;
    background: #38bdf8;
    color: #0f172a;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
  }
  .avatar-label:hover { background: #0ea5e9; }
  .avatar-preview { margin-top: 10px; }
  .avatar-preview img {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    border: 3px solid #38bdf8;
    object-fit: cover;
  }
  
  .rank-tabs {
    display: flex;
    justify-content: center;
    margin-bottom: 15px;
  }
  .rank-tab {
    padding: 8px 15px;
    background: #334155;
    cursor: pointer;
    border-radius: 5px;
    margin: 0 5px;
  }
  .rank-tab.active {
    background: #38bdf8;
    color: #0f172a;
    font-weight: bold;
  }
</style>
</head>
<body>
<div class="container">

  <h1>Quiz: Transcri√ß√£o do DNA</h1>

  <!-- Tela Sobre -->
  <div id="aboutScreen" class="hidden">
    <h2>‚ÑπÔ∏è Sobre o Jogo</h2>
    <div class="about-text">
      <p>O <strong>Quiz de Transcri√ß√£o do DNA</strong> foi criado para ensinar biologia molecular de forma divertida e interativa, utilizando uma mec√¢nica inspirada no <strong>Wordwall ‚Äì Abra a Caixa</strong>. Cada caixa representa uma pergunta que deve ser respondida corretamente para avan√ßar e acumular pontos.</p>
      <p>O jogo permite que voc√™ importe uma foto como avatar, personalize sua experi√™ncia, responda perguntas e acompanhe seu desempenho no ranking.</p>
      <p>Desenvolvido por alunos do <strong>IFSUL ‚Äì Campus Bag√©</strong>, <strong>Jamerson Salinas Pereira</strong> e <strong>Delciomar</strong>.</p>
    </div>
    <button onclick="goToStart()">Voltar</button>
  </div>

  <!-- Tela Ranking -->
  <div id="rankScreen" class="hidden">
    <h2>üèÜ Ranking</h2>
    
    <div class="rank-tabs">
      <div class="rank-tab active" onclick="changeRankTab('global')">Ranking Global</div>
      <div class="rank-tab" onclick="changeRankTab('personal')">Meu Hist√≥rico</div>
    </div>
    
    <div class="rank-list" id="rankList">Carregando ranking...</div>
    <button onclick="goToStart()">Voltar</button>
  </div>

  <!-- Tela inicial -->
  <div id="startScreen">
    <input type="text" id="playerName" placeholder="Digite seu nome">
    <div class="file-input">
      <p>üì∑ Escolha seu avatar:</p>
      <label for="avatarUpload" class="avatar-label">Selecionar imagem</label>
      <input type="file" id="avatarUpload" accept="image/*" onchange="uploadAvatar(event)" hidden>
      <div class="avatar-preview">
        <img id="avatarPreview" src="https://i.ibb.co/HfCrGWcK/0f6894e539589a50809e45833c8bb6c4.jpg" alt="Pr√©via do avatar">
      </div>
    </div>
    <button onclick="startGame()">‚ñ∂Ô∏è Iniciar Quiz</button>
    <h3>üìä Op√ß√µes</h3>
    <button onclick="showRank()">Ver Ranking</button>
    <button onclick="showAbout()">Sobre o Quiz</button>
  </div>

  <!-- Tela de Jogo -->
  <div id="gameScreen" class="hidden">
    <div class="scoreboard">
      <span id="score">Pontos: 0</span>
      <span id="playerInfo"></span>
      <img id="playerAvatar" src="">
    </div>
    <div class="question" id="questionText"></div>
    <div class="options" id="options"></div>
    <div class="timer">Tempo: <span id="timeLeft">30</span>s</div>
    <button onclick="stopGame()">Parar</button>
  </div>

  <!-- Tela de Resultado -->
  <div id="resultScreen" class="hidden">
    <h2>Fim do Quiz!</h2>
    <p id="finalScore"></p>
    <p id="finalTime"></p>
    <button onclick="playAgain()">Jogar Novamente</button>
    <button onclick="goToStart()">Voltar</button>
    <button onclick="showRank()">Ver Ranking</button>
  </div>

</div>

<script>
const allQuestions = [
  {q:"O que representa o dogma central da biologia molecular?", options:["RNA ‚Üí DNA ‚Üí Prote√≠na","DNA ‚Üí RNA ‚Üí Prote√≠na","DNA ‚Üí Prote√≠na ‚Üí RNA","Prote√≠na ‚Üí RNA ‚Üí DNA"], answer:"DNA ‚Üí RNA ‚Üí Prote√≠na"},
  {q:"Quais s√£o as tr√™s etapas principais do dogma central?", options:["Transcri√ß√£o, Tradu√ß√£o, Muta√ß√£o","Replica√ß√£o, Transcri√ß√£o, Tradu√ß√£o","Replica√ß√£o, Tradu√ß√£o, Express√£o","Muta√ß√£o, Transcri√ß√£o, Replica√ß√£o"], answer:"Replica√ß√£o, Transcri√ß√£o, Tradu√ß√£o"},
  {q:"Qual √© a exce√ß√£o ao dogma central encontrada em alguns v√≠rus?", options:["DNA direto para prote√≠na","RNA sendo replicado sem DNA","Transcri√ß√£o reversa","Prote√≠nas gerando DNA"], answer:"Transcri√ß√£o reversa"},
  {q:"O que √© a transcri√ß√£o reversa e qual enzima a realiza?", options:["S√≠ntese de DNA a partir de RNA pela transcriptase reversa","S√≠ntese de RNA a partir de prote√≠nas pela polimerase","S√≠ntese de prote√≠nas a partir do DNA pela ribossomo","S√≠ntese de DNA a partir de DNA pela DNA polimerase"], answer:"S√≠ntese de DNA a partir de RNA pela transcriptase reversa"},
  {q:"Quem criou o termo ‚Äúgene‚Äù e em que ano?", options:["Charles Darwin, 1865","Wilhelm Johannsen, 1909","Gregor Mendel, 1859","Watson e Crick, 1953"], answer:"Wilhelm Johannsen, 1909"},
  {q:"Como definimos gene atualmente?", options:["Um peda√ßo de RNA que gera prote√≠nas","Um fragmento de DNA que sempre gera prote√≠nas","Uma sequ√™ncia de DNA que pode ser transcrita em RNA","Um peda√ßo de prote√≠na com fun√ß√£o"], answer:"Uma sequ√™ncia de DNA que pode ser transcrita em RNA"},
  {q:"O que √© uma unidade de transcri√ß√£o?", options:["Parte do DNA que gera prote√≠nas diretamente","Segmento do DNA transcrito em uma √∫nica mol√©cula de RNA","Sequ√™ncia de amino√°cidos","Grupo de genes que n√£o s√£o expressos"], answer:"Segmento do DNA transcrito em uma √∫nica mol√©cula de RNA"},
  {q:"Qual a fun√ß√£o da regi√£o promotora em um gene?", options:["Finalizar a transcri√ß√£o","Orientar a tradu√ß√£o","Indicar onde a RNA polimerase deve iniciar a transcri√ß√£o","Proteger o DNA de muta√ß√µes"], answer:"Indicar onde a RNA polimerase deve iniciar a transcri√ß√£o"},
  {q:"O que define o t√©rmino de uma unidade de transcri√ß√£o g√™nica?", options:["A regi√£o promotora","O c√≥don de in√≠cio","O c√≥don de parada ou sequ√™ncia terminal","A polimerase de DNA"], answer:"O c√≥don de parada ou sequ√™ncia terminal"},
  {q:"Qual a base complementar da Adenina no RNA?", options:["Timina","Uracila","Guanina","Citosina"], answer:"Uracila"},
  {q:"O RNA mensageiro √© produzido a partir de qual mol√©cula?", options:["Prote√≠na","DNA","Ribossomo","Lip√≠dio"], answer:"DNA"},
  {q:"Qual enzima √© respons√°vel pela transcri√ß√£o do DNA?", options:["RNA Polimerase","DNA Ligase","Helicase","Topoisomerase"], answer:"RNA Polimerase"},
  {q:"Qual base nitrogenada N√ÉO existe no RNA?", options:["Uracila","Timina","Guanina","Adenina"], answer:"Timina"},
  {q:"A transcri√ß√£o ocorre em qual parte da c√©lula?", options:["N√∫cleo","Citoplasma","Mitoc√¥ndria","Ribossomo"], answer:"N√∫cleo"}
];

let questions = [];
let player = {name:"", avatar:"", score:0, time:0};
let currentQuestion = 0;
let timer;
let timeLeft = 30;
let startTime;
let currentRankTab = 'global'; // Controla qual aba do ranking est√° ativa

// Chave √∫nica para identificar este "sistema global" no localStorage
const GLOBAL_RANK_KEY = "dnaQuizGlobalRank";
const PERSONAL_HISTORY_KEY = "dnaQuizPersonalHistory";

// Inicializa os dados no localStorage se n√£o existirem
function initializeStorage() {
  if (!localStorage.getItem(GLOBAL_RANK_KEY)) {
    localStorage.setItem(GLOBAL_RANK_KEY, JSON.stringify([]));
  }
  if (!localStorage.getItem(PERSONAL_HISTORY_KEY)) {
    localStorage.setItem(PERSONAL_HISTORY_KEY, JSON.stringify([]));
  }
}

// Obt√©m o ranking global
function getGlobalRank() {
  return JSON.parse(localStorage.getItem(GLOBAL_RANK_KEY)) || [];
}

// Obt√©m o hist√≥rico pessoal
function getPersonalHistory() {
  return JSON.parse(localStorage.getItem(PERSONAL_HISTORY_KEY)) || [];
}

// Salva uma nova pontua√ß√£o no ranking global
function saveToGlobalRank(scoreData) {
  const globalRank = getGlobalRank();
  
  // Adiciona a nova pontua√ß√£o
  globalRank.push(scoreData);
  
  // Ordena por pontua√ß√£o (decrescente) e tempo (crescente)
  globalRank.sort((a, b) => {
    if (b.score !== a.score) return b.score - a.score;
    return a.time - b.time;
  });
  
  // Mant√©m apenas as top 100 pontua√ß√µes
  const trimmedRank = globalRank.slice(0, 100);
  
  // Salva no localStorage
  localStorage.setItem(GLOBAL_RANK_KEY, JSON.stringify(trimmedRank));
  return trimmedRank;
}

// Salva no hist√≥rico pessoal
function saveToPersonalHistory(scoreData) {
  const personalHistory = getPersonalHistory();
  
  // Adiciona a nova pontua√ß√£o
  personalHistory.push(scoreData);
  
  // Ordena por data (mais recente primeiro)
  personalHistory.sort((a, b) => new Date(b.date) - new Date(a.date));
  
  // Mant√©m apenas as 50 √∫ltimas pontua√ß√µes
  const trimmedHistory = personalHistory.slice(0, 50);
  
  // Salva no localStorage
  localStorage.setItem(PERSONAL_HISTORY_KEY, JSON.stringify(trimmedHistory));
  return trimmedHistory;
}

// Atualiza a exibi√ß√£o do ranking
function updateRankDisplay() {
  let data = [];
  let title = "";
  
  if (currentRankTab === 'global') {
    data = getGlobalRank();
    title = "Ranking Global - Top 100";
  } else {
    data = getPersonalHistory();
    title = "Meu Hist√≥rico - √öltimas 50 Partidas";
  }
  
  const medals = ["ü•á", "ü•à", "ü•â"];
  const list = data.length > 0 
    ? data.map((item, i) => {
        const medal = currentRankTab === 'global' && i < 3 ? medals[i] : `#${i+1}`;
        const date = currentRankTab === 'personal' ? new Date(item.date).toLocaleDateString('pt-BR') : '';
        
        return `<div style="display:flex; align-items:center; gap:8px; margin:5px 0; padding:5px; border-bottom:1px solid #334155;">
                  <strong>${medal}</strong>
                  <img src="${item.avatar}" width="35" height="35" style="border-radius:50%; border:2px solid #38bdf8;">
                  <span style="flex:1;">${item.name}</span>
                  <span style="font-weight:bold;">${item.score} pts</span>
                  <span style="color:#94a3b8; font-size:14px;">${item.time}s</span>
                  ${currentRankTab === 'personal' ? `<span style="color:#64748b; font-size:12px;">${date}</span>` : ''}
                </div>`;
      }).join("")
    : `<p style="text-align:center; color:#94a3b8;">Nenhum dado dispon√≠vel</p>`;
  
  document.getElementById("rankList").innerHTML = `<h3 style="margin-top:0;">${title}</h3>` + list;
}

// Alterna entre as abas do ranking
function changeRankTab(tab) {
  currentRankTab = tab;
  
  // Atualiza a apar√™ncia das abas
  document.querySelectorAll('.rank-tab').forEach(element => {
    element.classList.remove('active');
  });
  document.querySelector(`.rank-tab:nth-child(${tab === 'global' ? 1 : 2})`).classList.add('active');
  
  // Atualiza a exibi√ß√£o
  updateRankDisplay();
}

// Fun√ß√µes de navega√ß√£o
function goToStart(){
  ["aboutScreen","rankScreen","resultScreen","gameScreen"].forEach(id=>document.getElementById(id).classList.add("hidden"));
  document.getElementById("startScreen").classList.remove("hidden");
}

function showRank(){ 
  initializeStorage();
  changeRankTab('global');
  ["startScreen","resultScreen","gameScreen"].forEach(id=>document.getElementById(id).classList.add("hidden")); 
  document.getElementById("rankScreen").classList.remove("hidden"); 
}

function showAbout(){ 
  ["startScreen","rankScreen","resultScreen","gameScreen"].forEach(id=>document.getElementById(id).classList.add("hidden")); 
  document.getElementById("aboutScreen").classList.remove("hidden"); 
}

function uploadAvatar(event){
  const file = event.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = function(e){
      player.avatar = e.target.result;
      document.getElementById("avatarPreview").src = e.target.result;
    }
    reader.readAsDataURL(file);
  }
}

function startGame(){
  player.name = document.getElementById("playerName").value || "Visitante";
  player.score = 0;
  player.time = 0;
  currentQuestion = 0;
  startTime = Date.now();
  
  if(!player.avatar) {
    player.avatar = "https://i.ibb.co/HfCrGWcK/0f6894e539589a50809e45833c8bb6c4.jpg";
  }
  
  document.getElementById("playerAvatar").src = player.avatar;
  document.getElementById("playerInfo").innerText = player.name;
  document.getElementById("score").innerText = "Pontos: 0";
  
  questions = [...allQuestions].sort(()=>0.5-Math.random());
  document.getElementById("startScreen").classList.add("hidden");
  document.getElementById("gameScreen").classList.remove("hidden");
  
  loadQuestion();
}

function loadQuestion(){
  if(currentQuestion >= questions.length){ 
    endGame(true); 
    return; 
  }
  
  const q = questions[currentQuestion];
  document.getElementById("questionText").innerText = q.q;
  
  const opts = document.getElementById("options");
  opts.innerHTML = "";
  
  q.options.forEach(opt => {
    const btn = document.createElement("button");
    btn.innerText = opt;
    btn.onclick = () => checkAnswer(opt);
    opts.appendChild(btn);
  });
  
  timeLeft = 30;
  document.getElementById("timeLeft").innerText = timeLeft;
  
  clearInterval(timer);
  timer = setInterval(() => {
    timeLeft--;
    document.getElementById("timeLeft").innerText = timeLeft;
    
    if(timeLeft <= 0){ 
      clearInterval(timer); 
      currentQuestion++; 
      loadQuestion(); 
    }
  }, 1000);
}

function checkAnswer(answer){
  clearInterval(timer);
  const q = questions[currentQuestion];
  
  if(answer === q.answer){
    const points = Math.max(1, 10 - (30 - timeLeft));
    player.score += points;
    document.getElementById("score").innerText = "Pontos: " + player.score;
  }
  
  currentQuestion++;
  loadQuestion();
}

function endGame(ended=true){
  clearInterval(timer);
  player.time = Math.floor((Date.now() - startTime)/1000);
  
  if(ended){
    // Prepara os dados para salvar
    const scoreData = {
      name: player.name,
      avatar: player.avatar,
      score: player.score,
      time: player.time,
      date: new Date().toISOString()
    };
    
    // Salva nos rankings
    initializeStorage();
    saveToGlobalRank(scoreData);
    saveToPersonalHistory(scoreData);
  }
  
  document.getElementById("gameScreen").classList.add("hidden");
  document.getElementById("resultScreen").classList.remove("hidden");
  document.getElementById("finalScore").innerText = "Pontua√ß√£o final: " + player.score;
  document.getElementById("finalTime").innerText = "Tempo total: " + player.time + "s";
}

function playAgain(){
  player.score = 0;
  player.time = 0;
  currentQuestion = 0;
  startTime = Date.now();
  
  document.getElementById("score").innerText = "Pontos: 0";
  document.getElementById("resultScreen").classList.add("hidden");
  document.getElementById("gameScreen").classList.remove("hidden");
  
  questions = [...allQuestions].sort(()=>0.5-Math.random());
  loadQuestion();
}

function stopGame(){ 
  endGame(false); 
}

// Inicializa o armazenamento quando a p√°gina carrega
initializeStorage();
</script>
</body>
</html>
