<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Quiz - Transcri√ß√£o do DNA</title>
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 0;
    padding: 0;
    background: linear-gradient(to right, #0f172a, #1e293b);
    color: #f8fafc;
    display: flex;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
  }

  .container {
    background: #1e293b;
    border-radius: 15px;
    padding: 25px;
    width: 95%;
    max-width: 700px;
    box-shadow: 0 6px 15px rgba(0,0,0,0.4);
    text-align: center;
  }

  h1 { margin-bottom: 20px; color: #38bdf8; }
  h2,h3 { color: #38bdf8; margin-bottom: 10px; }

  input[type="text"] {
    width: 80%;
    padding: 10px;
    border-radius: 8px;
    border: 2px solid #38bdf8;
    font-size: 16px;
    text-align: center;
    margin-bottom: 15px;
    outline: none;
    transition: 0.3s;
  }
  input[type="text"]:focus { border-color: #0ea5e9; }

  button {
    padding: 10px 20px;
    margin: 8px;
    border: none;
    border-radius: 8px;
    background: #38bdf8;
    color: #0f172a;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
  }
  button:hover { background: #0ea5e9; }

  .hidden { display: none; }

  .scoreboard {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    margin-bottom: 10px;
    gap: 10px;
    font-size: 14px;
  }
  .scoreboard img {
    width: 35px;
    height: 35px;
    border-radius: 50%;
    border: 2px solid #38bdf8;
    object-fit: cover;
  }

  .question { font-size: 18px; margin-bottom: 15px; }
  .options { display: flex; flex-direction: column; gap: 10px; }

  .timer { font-size: 16px; margin-top: 10px; color: #facc15; font-weight: bold; }

  .rank-list, .about-text {
    text-align: left;
    margin: 10px 0;
    background: #0f172a;
    border-radius: 10px;
    padding: 10px;
    max-height: 250px;
    overflow-y: auto;
  }

  .file-input { margin: 15px 0; text-align: center; }
  .avatar-label {
    display: inline-block;
    padding: 8px 15px;
    border-radius: 8px;
    background: #38bdf8;
    color: #0f172a;
    font-weight: bold;
    cursor: pointer;
    transition: 0.3s;
  }
  .avatar-label:hover { background: #0ea5e9; }
  .avatar-preview { margin-top: 10px; }
  .avatar-preview img {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    border: 3px solid #38bdf8;
    object-fit: cover;
  }
  
  .rank-item {
    display: flex;
    align-items: center;
    gap: 10px;
    margin: 8px 0;
    padding: 8px;
    border-radius: 8px;
    background: #1e293b;
  }
  .rank-position {
    font-weight: bold;
    width: 30px;
    text-align: center;
  }
  .rank-avatar img {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    border: 2px solid #38bdf8;
  }
  .rank-info {
    flex: 1;
  }
  .rank-score {
    font-weight: bold;
    color: #facc15;
  }
  
  .loading {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255,255,255,0.3);
    border-radius: 50%;
    border-top-color: #38bdf8;
    animation: spin 1s ease-in-out infinite;
  }
  
  @keyframes spin {
    to { transform: rotate(360deg); }
  }
  
  .error-message {
    color: #ef4444;
    text-align: center;
    padding: 10px;
    background: rgba(239, 68, 68, 0.1);
    border-radius: 8px;
    margin: 10px 0;
  }
</style>
<!-- Adicione o SDK do Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
</head>
<body>
<div class="container">

  <h1>Quiz: Transcri√ß√£o do DNA</h1>

  <!-- Tela Sobre -->
  <div id="aboutScreen" class="hidden">
    <h2>‚ÑπÔ∏è Sobre o Jogo</h2>
    <div class="about-text">
      <p>O <strong>Quiz de Transcri√ß√£o do DNA</strong> foi criado para ensinar biologia molecular de forma divertida e interativa, utilizando uma mec√¢nica inspirada no <strong>Wordwall ‚Äì Abra a Caixa</strong>. Cada caixa representa uma pergunta que deve ser respondida corretamente para avan√ßar e acumular pontos.</p>
      <p>O jogo permite que voc√™ importe uma foto como avatar, personalize sua experi√™ncia, responda perguntas e acompanhe seu desempenho no ranking.</p>
      <p>Desenvolvido por alunos do <strong>IFSUL ‚Äì Campus Bag√©</strong>, <strong>Jamerson Salinas Pereira</strong> e <strong>Delciomar</strong>.</p>
    </div>
    <button onclick="goToStart()">Voltar</button>
  </div>

  <!-- Tela Ranking -->
  <div id="rankScreen" class="hidden">
    <h2>üèÜ Ranking Global - Top 10</h2>
    <div class="rank-list" id="rankList">
      <div style="text-align: center; padding: 20px;">
        <div class="loading"></div>
        <p>Carregando ranking...</p>
      </div>
    </div>
    <button onclick="goToStart()">Voltar</button>
  </div>

  <!-- Tela inicial -->
  <div id="startScreen">
    <input type="text" id="playerName" placeholder="Digite seu nome">
    <div class="file-input">
      <p>üì∑ Escolha seu avatar:</p>
      <label for="avatarUpload" class="avatar-label">Selecionar imagem</label>
      <input type="file" id="avatarUpload" accept="image/*" onchange="uploadAvatar(event)" hidden>
      <div class="avatar-preview">
        <img id="avatarPreview" src="https://i.ibb.co/HfCrGWcK/0f6894e539589a50809e45833c8bb6c4.jpg" alt="Pr√©via do avatar">
      </div>
    </div>
    <button onclick="startGame()">‚ñ∂Ô∏è Iniciar Quiz</button>
    <h3>üìä Op√ß√µes</h3>
    <button onclick="showRank()">Ver Ranking</button>
    <button onclick="showAbout()">Sobre o Quiz</button>
  </div>

  <!-- Tela de Jogo -->
  <div id="gameScreen" class="hidden">
    <div class="scoreboard">
      <span id="score">Pontos: 0</span>
      <span id="playerInfo"></span>
      <img id="playerAvatar" src="">
    </div>
    <div class="question" id="questionText"></div>
    <div class="options" id="options"></div>
    <div class="timer">Tempo: <span id="timeLeft">30</span>s</div>
    <button onclick="stopGame()">Parar</button>
  </div>

  <!-- Tela de Resultado -->
  <div id="resultScreen" class="hidden">
    <h2>Fim do Quiz!</h2>
    <p id="finalScore"></p>
    <p id="finalTime"></p>
    <div id="firebaseError" class="error-message hidden"></div>
    <button onclick="playAgain()">Jogar Novamente</button>
    <button onclick="goToStart()">Voltar</button>
    <button onclick="showRank()">Ver Ranking</button>
  </div>

</div>

<script>
// Configura√ß√£o do Firebase
const firebaseConfig = {
  apiKey: "AIzaSyDFf0vlW5P5zNXRAsR4OfeBliSfXQvO_k4",
  authDomain: "quiz-transcricao-do-dna.firebaseapp.com",
  projectId: "quiz-transcricao-do-dna",
  storageBucket: "quiz-transcricao-do-dna.firebasestorage.app",
  messagingSenderId: "442557590223",
  appId: "1:442557590223:web:8a4f87a8f03ab29d6125ba",
  measurementId: "G-KX8CS9KPNF"
};

// Inicializar Firebase
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const allQuestions = [
  {q:"O que representa o dogma central da biologia molecular?", options:["RNA ‚Üí DNA ‚Üí Prote√≠na","DNA ‚Üí RNA ‚Üí Prote√≠na","DNA ‚Üí Prote√≠na ‚Üí RNA","Prote√≠na ‚Üí RNA ‚Üí DNA"], answer:"DNA ‚Üí RNA ‚Üí Prote√≠na"},
  {q:"Quais s√£o as tr√™s etapas principais do dogma central?", options:["Transcri√ß√£o, Tradu√ß√£o, Muta√ß√£o","Replica√ß√£o, Transcri√ß√£o, Tradu√ß√£o","Replica√ß√£o, Tradu√ß√£o, Express√£o","Muta√ß√£o, Transcri√ß√£o, Replica√ß√£o"], answer:"Replica√ß√£o, Transcri√ß√£o, Tradu√ß√£o"},
  {q:"Qual √© a exce√ß√£o ao dogma central encontrada em alguns v√≠rus?", options:["DNA direto para prote√≠na","RNA sendo replicado sem DNA","Transcri√ß√£o reversa","Prote√≠nas gerando DNA"], answer:"Transcri√ß√£o reversa"},
  {q:"O que √© a transcri√ß√£o reversa e qual enzima a realiza?", options:["S√≠ntese de DNA a partir de RNA pela transcriptase reversa","S√≠ntese de RNA a partir de prote√≠nas pela polimerase","S√≠ntese de prote√≠nas a partir do DNA pela ribossomo","S√≠ntese de DNA a partir de DNA pela DNA polimerase"], answer:"S√≠ntese de DNA a partir de RNA pela transcriptase reversa"},
  {q:"Quem criou o termo ‚Äúgene‚Äù e em que ano?", options:["Charles Darwin, 1865","Wilhelm Johannsen, 1909","Gregor Mendel, 1859","Watson e Crick, 1953"], answer:"Wilhelm Johannsen, 1909"},
  {q:"Como definimos gene atualmente?", options:["Um peda√ßo de RNA que gera prote√≠nas","Um fragmento de DNA que sempre gera prote√≠nas","Uma sequ√™ncia de DNA que pode ser transcrita em RNA","Um peda√ßo de prote√≠na com fun√ß√£o"], answer:"Uma sequ√™ncia de DNA que pode ser transcrita em RNA"},
  {q:"O que √© uma unidade de transcri√ß√£o?", options:["Parte do DNA que gera prote√≠nas diretamente","Segmento do DNA transcrito em uma √∫nica mol√©cula de RNA","Sequ√™ncia de amino√°cidos","Grupo de genes que n√£o s√£o expressos"], answer:"Segmento do DNA transcrito em uma √∫nica mol√©cula de RNA"},
  {q:"Qual a fun√ß√£o da regi√£o promotora em um gene?", options:["Finalizar a transcri√ß√£o","Orientar a tradu√ß√£o","Indicar onde a RNA polimerase deve iniciar a transcri√ß√£o","Proteger o DNA de muta√ß√µes"], answer:"Indicar onde a RNA polimerase deve iniciar a transcri√ß√£o"},
  {q:"O que define o t√©rmino de uma unidade de transcri√ß√£o g√™nica?", options:["A regi√£o promotora","O c√≥don de in√≠cio","O c√≥don de parada ou sequ√™ncia terminal","A polimerase de DNA"], answer:"O c√≥don de parada ou sequ√™ncia terminal"},
  {q:"Qual a base complementar da Adenina no RNA?", options:["Timina","Uracila","Guanina","Citosina"], answer:"Uracila"},
  {q:"O RNA mensageiro √© produzido a partir de qual mol√©cula?", options:["Prote√≠na","DNA","Ribossomo","Lip√≠dio"], answer:"DNA"},
  {q:"Qual enzima √© respons√°vel pela transcri√ß√£o do DNA?", options:["RNA Polimerase","DNA Ligase","Helicase","Topoisomerase"], answer:"RNA Polimerase"},
  {q:"Qual base nitrogenada N√ÉO existe no RNA?", options:["Uracila","Timina","Guanina","Adenina"], answer:"Timina"},
  {q:"A transcri√ß√£o ocorre em qual parte da c√©lula?", options:["N√∫cleo","Citoplasma","Mitoc√¥ndria","Ribossomo"], answer:"N√∫cleo"}
];

let questions = [];
let player = {name:"", avatar:"", score:0, time:0};
let currentQuestion = 0;
let timer;
let timeLeft = 30;
let startTime;
let playerId = localStorage.getItem('playerId') || generateId();

const defaultAvatar = "https://i.ibb.co/HfCrGWcK/0f6894e539589a50809e45833c8bb6c4.jpg";

// Gerar ID √∫nico para o jogador
function generateId() {
  const id = 'player_' + Math.random().toString(36).substr(2, 9);
  localStorage.setItem('playerId', id);
  return id;
}

// Salvar pontua√ß√£o no Firebase
async function saveScoreToFirebase(scoreData) {
  try {
    // Adicionar ID do jogador aos dados
    scoreData.playerId = playerId;
    
    // Adicionar timestamp
    scoreData.timestamp = firebase.firestore.FieldValue.serverTimestamp();
    
    // Salvar no Firestore
    await db.collection('scores').add(scoreData);
    
    console.log('Pontua√ß√£o salva com sucesso!');
    hideFirebaseError();
    return true;
  } catch (error) {
    console.error('Erro ao salvar pontua√ß√£o:', error);
    showFirebaseError('Erro ao salvar pontua√ß√£o. Verifique sua conex√£o.');
    return false;
  }
}

// Buscar ranking do Firebase
async function getRankingFromFirebase() {
  try {
    const snapshot = await db.collection('scores')
      .orderBy('score', 'desc')
      .orderBy('time', 'asc')
      .orderBy('timestamp', 'desc')
      .limit(10)
      .get();
    
    const ranking = [];
    snapshot.forEach(doc => {
      ranking.push({ id: doc.id, ...doc.data() });
    });
    
    return ranking;
  } catch (error) {
    console.error('Erro ao buscar ranking:', error);
    showFirebaseError('Erro ao carregar ranking. Verifique sua conex√£o.');
    return [];
  }
}

// Mostrar erro do Firebase
function showFirebaseError(message) {
  const errorElement = document.getElementById('firebaseError');
  errorElement.textContent = message;
  errorElement.classList.remove('hidden');
}

// Esconder erro do Firebase
function hideFirebaseError() {
  const errorElement = document.getElementById('firebaseError');
  errorElement.classList.add('hidden');
}

// Atualizar a exibi√ß√£o do ranking
async function updateRankDisplay() {
  // Mostrar loading
  document.getElementById("rankList").innerHTML = `
    <div style="text-align: center; padding: 20px;">
      <div class="loading"></div>
      <p>Carregando ranking...</p>
    </div>
  `;
  
  try {
    const ranking = await getRankingFromFirebase();
    const medals = ["ü•á", "ü•à", "ü•â"];
    
    if (ranking.length === 0) {
      document.getElementById("rankList").innerHTML = "<p style='text-align:center; color:#94a3b8;'>Nenhuma pontua√ß√£o ainda</p>";
      return;
    }
    
    const rankingHTML = ranking.map((player, index) => {
      const medal = index < 3 ? medals[index] : "";
      
      return `
        <div class="rank-item">
          <div class="rank-position">${medal} ${index + 1}</div>
          <div class="rank-avatar">
            <img src="${player.avatar || defaultAvatar}" alt="${player.name}">
          </div>
          <div class="rank-info">
            <div>${player.name}</div>
            <div class="rank-score">${player.score} pontos ‚Ä¢ ${player.time}s</div>
          </div>
        </div>
      `;
    }).join("");
    
    document.getElementById("rankList").innerHTML = rankingHTML;
  } catch (error) {
    document.getElementById("rankList").innerHTML = `
      <p style='text-align:center; color:#ef4444;'>Erro ao carregar ranking</p>
    `;
  }
}

// Fun√ß√µes de navega√ß√£o
function goToStart(){
  ["aboutScreen","rankScreen","resultScreen","gameScreen"].forEach(id=>document.getElementById(id).classList.add("hidden"));
  document.getElementById("startScreen").classList.remove("hidden");
  hideFirebaseError();
}

function showRank(){ 
  ["startScreen","resultScreen","gameScreen"].forEach(id=>document.getElementById(id).classList.add("hidden")); 
  document.getElementById("rankScreen").classList.remove("hidden"); 
  updateRankDisplay();
}

function showAbout(){ 
  ["startScreen","rankScreen","resultScreen","gameScreen"].forEach(id=>document.getElementById(id).classList.add("hidden")); 
  document.getElementById("aboutScreen").classList.remove("hidden"); 
}

function uploadAvatar(event){
  const file = event.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = function(e){
      player.avatar = e.target.result;
      document.getElementById("avatarPreview").src = e.target.result;
    }
    reader.readAsDataURL(file);
  }
}

function startGame(){
  player.name = document.getElementById("playerName").value || "Visitante";
  player.score = 0;
  player.time = 0;
  currentQuestion = 0;
  startTime = Date.now();
  
  if(!player.avatar) {
    player.avatar = defaultAvatar;
  }
  
  document.getElementById("playerAvatar").src = player.avatar;
  document.getElementById("playerInfo").innerText = player.name;
  document.getElementById("score").innerText = "Pontos: 0";
  
  questions = [...allQuestions].sort(()=>0.5-Math.random());
  document.getElementById("startScreen").classList.add("hidden");
  document.getElementById("gameScreen").classList.remove("hidden");
  
  loadQuestion();
}

function loadQuestion(){
  if(currentQuestion >= questions.length){ 
    endGame(true); 
    return; 
  }
  
  const q = questions[currentQuestion];
  document.getElementById("questionText").innerText = q.q;
  
  const opts = document.getElementById("options");
  opts.innerHTML = "";
  
  q.options.forEach(opt => {
    const btn = document.createElement("button");
    btn.innerText = opt;
    btn.onclick = () => checkAnswer(opt);
    opts.appendChild(btn);
  });
  
  timeLeft = 30;
  document.getElementById("timeLeft").innerText = timeLeft;
  
  clearInterval(timer);
  timer = setInterval(() => {
    timeLeft--;
    document.getElementById("timeLeft").innerText = timeLeft;
    
    if(timeLeft <= 0){ 
      clearInterval(timer); 
      currentQuestion++; 
      loadQuestion(); 
    }
  }, 1000);
}

function checkAnswer(answer){
  clearInterval(timer);
  const q = questions[currentQuestion];
  
  if(answer === q.answer){
    const points = Math.max(1, 10 - (30 - timeLeft));
    player.score += points;
    document.getElementById("score").innerText = "Pontos: " + player.score;
  }
  
  currentQuestion++;
  loadQuestion();
}

async function endGame(ended=true){
  clearInterval(timer);
  player.time = Math.floor((Date.now() - startTime)/1000);
  
  if(ended){
    // Prepara os dados para salvar
    const scoreData = {
      name: player.name,
      avatar: player.avatar,
      score: player.score,
      time: player.time
    };
    
    // Salva no Firebase
    await saveScoreToFirebase(scoreData);
  }
  
  document.getElementById("gameScreen").classList.add("hidden");
  document.getElementById("resultScreen").classList.remove("hidden");
  document.getElementById("finalScore").innerText = "Pontua√ß√£o final: " + player.score;
  document.getElementById("finalTime").innerText = "Tempo total: " + player.time + "s";
}

function playAgain(){
  player.score = 0;
  player.time = 0;
  currentQuestion = 0;
  startTime = Date.now();
  
  document.getElementById("score").innerText = "Pontos: 0";
  document.getElementById("resultScreen").classList.add("hidden");
  document.getElementById("gameScreen").classList.remove("hidden");
  
  questions = [...allQuestions].sort(()=>0.5-Math.random());
  loadQuestion();
}

function stopGame(){ 
  endGame(false); 
}

// Inicializar quando a p√°gina carregar
hideFirebaseError();
</script>
</body>
</html>
